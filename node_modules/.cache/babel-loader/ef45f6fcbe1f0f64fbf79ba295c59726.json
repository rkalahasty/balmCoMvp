{"ast":null,"code":"\"use strict\";\n\nconst DOMException = require(\"domexception/webidl2js-wrapper\");\n\nconst StorageEvent = require(\"../generated/StorageEvent\");\n\nconst idlUtils = require(\"../generated/utils\");\n\nconst {\n  fireAnEvent\n} = require(\"../helpers/events\"); // https://html.spec.whatwg.org/multipage/webstorage.html#the-storage-interface\n\n\nclass StorageImpl {\n  constructor(globalObject, args, privateData) {\n    const {\n      associatedWindow,\n      storageArea,\n      url,\n      type,\n      storageQuota\n    } = privateData;\n    this._associatedWindow = associatedWindow;\n    this._items = storageArea;\n    this._url = url;\n    this._type = type;\n    this._quota = storageQuota;\n    this._globalObject = globalObject;\n  }\n\n  _dispatchStorageEvent(key, oldValue, newValue) {\n    return this._associatedWindow._currentOriginData.windowsInSameOrigin.filter(target => target !== this._associatedWindow).forEach(target => fireAnEvent(\"storage\", target, StorageEvent, {\n      key,\n      oldValue,\n      newValue,\n      url: this._url,\n      storageArea: target[\"_\" + this._type]\n    }));\n  }\n\n  get length() {\n    return this._items.size;\n  }\n\n  key(n) {\n    if (n >= this._items.size) {\n      return null;\n    }\n\n    return [...this._items.keys()][n];\n  }\n\n  getItem(key) {\n    if (this._items.has(key)) {\n      return this._items.get(key);\n    }\n\n    return null;\n  }\n\n  setItem(key, value) {\n    const oldValue = this._items.get(key) || null;\n\n    if (oldValue === value) {\n      return;\n    } // Concatenate all keys and values to measure their length against the quota\n\n\n    let itemsTotalLength = key.length + value.length;\n\n    for (const [curKey, curValue] of this._items) {\n      // If the key already exists, skip it as it will be set to the new value instead\n      if (key !== curKey) {\n        itemsTotalLength += curKey.length + curValue.length;\n      }\n    }\n\n    if (itemsTotalLength > this._quota) {\n      throw DOMException.create(this._globalObject, [`The ${this._quota}-code unit storage quota has been exceeded.`, \"QuotaExceededError\"]);\n    }\n\n    setTimeout(this._dispatchStorageEvent.bind(this), 0, key, oldValue, value);\n\n    this._items.set(key, value);\n  }\n\n  removeItem(key) {\n    if (this._items.has(key)) {\n      setTimeout(this._dispatchStorageEvent.bind(this), 0, key, this._items.get(key), null);\n\n      this._items.delete(key);\n    }\n  }\n\n  clear() {\n    if (this._items.size > 0) {\n      setTimeout(this._dispatchStorageEvent.bind(this), 0, null, null, null);\n\n      this._items.clear();\n    }\n  }\n\n  get [idlUtils.supportedPropertyNames]() {\n    return this._items.keys();\n  }\n\n}\n\nmodule.exports = {\n  implementation: StorageImpl\n};","map":{"version":3,"names":["DOMException","require","StorageEvent","idlUtils","fireAnEvent","StorageImpl","constructor","globalObject","args","privateData","associatedWindow","storageArea","url","type","storageQuota","_associatedWindow","_items","_url","_type","_quota","_globalObject","_dispatchStorageEvent","key","oldValue","newValue","_currentOriginData","windowsInSameOrigin","filter","target","forEach","length","size","n","keys","getItem","has","get","setItem","value","itemsTotalLength","curKey","curValue","create","setTimeout","bind","set","removeItem","delete","clear","supportedPropertyNames","module","exports","implementation"],"sources":["C:/Users/17033/balmco/node_modules/jsdom/lib/jsdom/living/webstorage/Storage-impl.js"],"sourcesContent":["\"use strict\";\n\nconst DOMException = require(\"domexception/webidl2js-wrapper\");\nconst StorageEvent = require(\"../generated/StorageEvent\");\nconst idlUtils = require(\"../generated/utils\");\nconst { fireAnEvent } = require(\"../helpers/events\");\n\n// https://html.spec.whatwg.org/multipage/webstorage.html#the-storage-interface\nclass StorageImpl {\n  constructor(globalObject, args, privateData) {\n    const { associatedWindow, storageArea, url, type, storageQuota } = privateData;\n\n    this._associatedWindow = associatedWindow;\n    this._items = storageArea;\n    this._url = url;\n    this._type = type;\n    this._quota = storageQuota;\n\n    this._globalObject = globalObject;\n  }\n\n  _dispatchStorageEvent(key, oldValue, newValue) {\n    return this._associatedWindow._currentOriginData.windowsInSameOrigin\n      .filter(target => target !== this._associatedWindow)\n      .forEach(target => fireAnEvent(\"storage\", target, StorageEvent, {\n        key,\n        oldValue,\n        newValue,\n        url: this._url,\n        storageArea: target[\"_\" + this._type]\n      }));\n  }\n\n  get length() {\n    return this._items.size;\n  }\n\n  key(n) {\n    if (n >= this._items.size) {\n      return null;\n    }\n    return [...this._items.keys()][n];\n  }\n\n  getItem(key) {\n    if (this._items.has(key)) {\n      return this._items.get(key);\n    }\n    return null;\n  }\n\n  setItem(key, value) {\n    const oldValue = this._items.get(key) || null;\n\n    if (oldValue === value) {\n      return;\n    }\n\n    // Concatenate all keys and values to measure their length against the quota\n    let itemsTotalLength = key.length + value.length;\n    for (const [curKey, curValue] of this._items) {\n      // If the key already exists, skip it as it will be set to the new value instead\n      if (key !== curKey) {\n        itemsTotalLength += curKey.length + curValue.length;\n      }\n    }\n    if (itemsTotalLength > this._quota) {\n      throw DOMException.create(this._globalObject, [\n        `The ${this._quota}-code unit storage quota has been exceeded.`,\n        \"QuotaExceededError\"\n      ]);\n    }\n\n    setTimeout(this._dispatchStorageEvent.bind(this), 0, key, oldValue, value);\n\n    this._items.set(key, value);\n  }\n\n  removeItem(key) {\n    if (this._items.has(key)) {\n      setTimeout(this._dispatchStorageEvent.bind(this), 0, key, this._items.get(key), null);\n\n      this._items.delete(key);\n    }\n  }\n\n  clear() {\n    if (this._items.size > 0) {\n      setTimeout(this._dispatchStorageEvent.bind(this), 0, null, null, null);\n\n      this._items.clear();\n    }\n  }\n\n  get [idlUtils.supportedPropertyNames]() {\n    return this._items.keys();\n  }\n}\n\nmodule.exports = {\n  implementation: StorageImpl\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}