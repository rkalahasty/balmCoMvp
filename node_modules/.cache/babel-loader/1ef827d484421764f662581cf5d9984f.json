{"ast":null,"code":"\"use strict\";\n\nconst fs = require(\"fs\");\n\nconst {\n  fileURLToPath\n} = require(\"url\");\n\nconst {\n  parseURL\n} = require(\"whatwg-url\");\n\nconst dataURLFromRecord = require(\"data-urls\").fromURLRecord;\n\nconst packageVersion = require(\"../../../../package.json\").version;\n\nconst agentFactory = require(\"../../living/helpers/agent-factory\");\n\nconst Request = require(\"../../living/helpers/http-request\");\n\nconst IS_BROWSER = Object.prototype.toString.call(process) !== \"[object process]\";\nmodule.exports = class ResourceLoader {\n  constructor() {\n    let {\n      strictSSL = true,\n      proxy = undefined,\n      userAgent = `Mozilla/5.0 (${process.platform || \"unknown OS\"}) AppleWebKit/537.36 ` + `(KHTML, like Gecko) jsdom/${packageVersion}`\n    } = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    this._strictSSL = strictSSL;\n    this._proxy = proxy;\n    this._userAgent = userAgent;\n  }\n\n  _readDataURL(urlRecord) {\n    const dataURL = dataURLFromRecord(urlRecord);\n    let timeoutId;\n    const promise = new Promise(resolve => {\n      timeoutId = setTimeout(resolve, 0, dataURL.body);\n    });\n\n    promise.abort = () => {\n      if (timeoutId !== undefined) {\n        clearTimeout(timeoutId);\n      }\n    };\n\n    return promise;\n  }\n\n  _readFile(filePath) {\n    let readableStream, abort; // Native Promises doesn't have an \"abort\" method.\n    // Creating a promise for two reason:\n    //   1. fetch always return a promise.\n    //   2. We need to add an abort handler.\n\n    const promise = new Promise((resolve, reject) => {\n      readableStream = fs.createReadStream(filePath);\n      let data = Buffer.alloc(0);\n      abort = reject;\n      readableStream.on(\"error\", reject);\n      readableStream.on(\"data\", chunk => {\n        data = Buffer.concat([data, chunk]);\n      });\n      readableStream.on(\"end\", () => {\n        resolve(data);\n      });\n    });\n\n    promise.abort = () => {\n      readableStream.destroy();\n      const error = new Error(\"request canceled by user\");\n      error.isAbortError = true;\n      abort(error);\n    };\n\n    return promise;\n  }\n\n  fetch(urlString) {\n    let {\n      accept,\n      cookieJar,\n      referrer\n    } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    const url = parseURL(urlString);\n\n    if (!url) {\n      return Promise.reject(new Error(`Tried to fetch invalid URL ${urlString}`));\n    }\n\n    switch (url.scheme) {\n      case \"data\":\n        {\n          return this._readDataURL(url);\n        }\n\n      case \"http\":\n      case \"https\":\n        {\n          const agents = agentFactory(this._proxy, this._strictSSL);\n          const headers = {\n            \"User-Agent\": this._userAgent,\n            \"Accept-Language\": \"en\",\n            \"Accept-Encoding\": \"gzip\",\n            \"Accept\": accept || \"*/*\"\n          };\n\n          if (referrer && !IS_BROWSER) {\n            headers.Referer = referrer;\n          }\n\n          const requestClient = new Request(urlString, {\n            followRedirects: true,\n            cookieJar,\n            agents\n          }, {\n            headers\n          });\n          const promise = new Promise((resolve, reject) => {\n            const accumulated = [];\n            requestClient.once(\"response\", res => {\n              promise.response = res;\n              const {\n                statusCode\n              } = res; // TODO This deviates from the spec when it comes to\n              // loading resources such as images\n\n              if (statusCode < 200 || statusCode > 299) {\n                requestClient.abort();\n                reject(new Error(`Resource was not loaded. Status: ${statusCode}`));\n              }\n            });\n            requestClient.on(\"data\", chunk => {\n              accumulated.push(chunk);\n            });\n            requestClient.on(\"end\", () => resolve(Buffer.concat(accumulated)));\n            requestClient.on(\"error\", reject);\n          }); // The method fromURL in lib/api.js crashes without the following four\n          // properties defined on the Promise instance, causing the test suite to halt\n\n          requestClient.on(\"end\", () => {\n            promise.href = requestClient.currentURL;\n          });\n          promise.abort = requestClient.abort.bind(requestClient);\n\n          promise.getHeader = name => headers[name] || requestClient.getHeader(name);\n\n          requestClient.end();\n          return promise;\n        }\n\n      case \"file\":\n        {\n          try {\n            return this._readFile(fileURLToPath(urlString));\n          } catch (e) {\n            return Promise.reject(e);\n          }\n        }\n\n      default:\n        {\n          return Promise.reject(new Error(`Tried to fetch URL ${urlString} with invalid scheme ${url.scheme}`));\n        }\n    }\n  }\n\n};","map":{"version":3,"names":["fs","require","fileURLToPath","parseURL","dataURLFromRecord","fromURLRecord","packageVersion","version","agentFactory","Request","IS_BROWSER","Object","prototype","toString","call","process","module","exports","ResourceLoader","constructor","strictSSL","proxy","undefined","userAgent","platform","_strictSSL","_proxy","_userAgent","_readDataURL","urlRecord","dataURL","timeoutId","promise","Promise","resolve","setTimeout","body","abort","clearTimeout","_readFile","filePath","readableStream","reject","createReadStream","data","Buffer","alloc","on","chunk","concat","destroy","error","Error","isAbortError","fetch","urlString","accept","cookieJar","referrer","url","scheme","agents","headers","Referer","requestClient","followRedirects","accumulated","once","res","response","statusCode","push","href","currentURL","bind","getHeader","name","end","e"],"sources":["C:/Users/17033/balmco/node_modules/jsdom/lib/jsdom/browser/resources/resource-loader.js"],"sourcesContent":["\"use strict\";\nconst fs = require(\"fs\");\nconst { fileURLToPath } = require(\"url\");\nconst { parseURL } = require(\"whatwg-url\");\nconst dataURLFromRecord = require(\"data-urls\").fromURLRecord;\nconst packageVersion = require(\"../../../../package.json\").version;\nconst agentFactory = require(\"../../living/helpers/agent-factory\");\nconst Request = require(\"../../living/helpers/http-request\");\n\nconst IS_BROWSER = Object.prototype.toString.call(process) !== \"[object process]\";\n\nmodule.exports = class ResourceLoader {\n  constructor({\n    strictSSL = true,\n    proxy = undefined,\n    userAgent = `Mozilla/5.0 (${process.platform || \"unknown OS\"}) AppleWebKit/537.36 ` +\n                `(KHTML, like Gecko) jsdom/${packageVersion}`\n  } = {}) {\n    this._strictSSL = strictSSL;\n    this._proxy = proxy;\n    this._userAgent = userAgent;\n  }\n\n  _readDataURL(urlRecord) {\n    const dataURL = dataURLFromRecord(urlRecord);\n    let timeoutId;\n    const promise = new Promise(resolve => {\n      timeoutId = setTimeout(resolve, 0, dataURL.body);\n    });\n    promise.abort = () => {\n      if (timeoutId !== undefined) {\n        clearTimeout(timeoutId);\n      }\n    };\n    return promise;\n  }\n\n  _readFile(filePath) {\n    let readableStream, abort; // Native Promises doesn't have an \"abort\" method.\n\n    // Creating a promise for two reason:\n    //   1. fetch always return a promise.\n    //   2. We need to add an abort handler.\n    const promise = new Promise((resolve, reject) => {\n      readableStream = fs.createReadStream(filePath);\n      let data = Buffer.alloc(0);\n\n      abort = reject;\n\n      readableStream.on(\"error\", reject);\n\n      readableStream.on(\"data\", chunk => {\n        data = Buffer.concat([data, chunk]);\n      });\n\n      readableStream.on(\"end\", () => {\n        resolve(data);\n      });\n    });\n\n    promise.abort = () => {\n      readableStream.destroy();\n      const error = new Error(\"request canceled by user\");\n      error.isAbortError = true;\n      abort(error);\n    };\n\n    return promise;\n  }\n\n  fetch(urlString, { accept, cookieJar, referrer } = {}) {\n    const url = parseURL(urlString);\n\n    if (!url) {\n      return Promise.reject(new Error(`Tried to fetch invalid URL ${urlString}`));\n    }\n\n    switch (url.scheme) {\n      case \"data\": {\n        return this._readDataURL(url);\n      }\n\n      case \"http\":\n      case \"https\": {\n        const agents = agentFactory(this._proxy, this._strictSSL);\n        const headers = {\n          \"User-Agent\": this._userAgent,\n          \"Accept-Language\": \"en\",\n          \"Accept-Encoding\": \"gzip\",\n          \"Accept\": accept || \"*/*\"\n        };\n        if (referrer && !IS_BROWSER) {\n          headers.Referer = referrer;\n        }\n        const requestClient = new Request(\n          urlString,\n          { followRedirects: true, cookieJar, agents },\n          { headers }\n        );\n        const promise = new Promise((resolve, reject) => {\n          const accumulated = [];\n          requestClient.once(\"response\", res => {\n            promise.response = res;\n            const { statusCode } = res;\n            // TODO This deviates from the spec when it comes to\n            // loading resources such as images\n            if (statusCode < 200 || statusCode > 299) {\n              requestClient.abort();\n              reject(new Error(`Resource was not loaded. Status: ${statusCode}`));\n            }\n          });\n          requestClient.on(\"data\", chunk => {\n            accumulated.push(chunk);\n          });\n          requestClient.on(\"end\", () => resolve(Buffer.concat(accumulated)));\n          requestClient.on(\"error\", reject);\n        });\n        // The method fromURL in lib/api.js crashes without the following four\n        // properties defined on the Promise instance, causing the test suite to halt\n        requestClient.on(\"end\", () => {\n          promise.href = requestClient.currentURL;\n        });\n        promise.abort = requestClient.abort.bind(requestClient);\n        promise.getHeader = name => headers[name] || requestClient.getHeader(name);\n        requestClient.end();\n        return promise;\n      }\n\n      case \"file\": {\n        try {\n          return this._readFile(fileURLToPath(urlString));\n        } catch (e) {\n          return Promise.reject(e);\n        }\n      }\n\n      default: {\n        return Promise.reject(new Error(`Tried to fetch URL ${urlString} with invalid scheme ${url.scheme}`));\n      }\n    }\n  }\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}