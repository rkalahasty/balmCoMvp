{"ast":null,"code":"\"use strict\";\n\nconst vm = require(\"vm\");\n\nconst webIDLConversions = require(\"webidl-conversions\");\n\nconst {\n  CSSStyleDeclaration\n} = require(\"cssstyle\");\n\nconst {\n  Performance: RawPerformance\n} = require(\"w3c-hr-time\");\n\nconst notImplemented = require(\"./not-implemented\");\n\nconst {\n  installInterfaces\n} = require(\"../living/interfaces\");\n\nconst {\n  define,\n  mixin\n} = require(\"../utils\");\n\nconst Element = require(\"../living/generated/Element\");\n\nconst EventTarget = require(\"../living/generated/EventTarget\");\n\nconst EventHandlerNonNull = require(\"../living/generated/EventHandlerNonNull\");\n\nconst OnBeforeUnloadEventHandlerNonNull = require(\"../living/generated/OnBeforeUnloadEventHandlerNonNull\");\n\nconst OnErrorEventHandlerNonNull = require(\"../living/generated/OnErrorEventHandlerNonNull\");\n\nconst PageTransitionEvent = require(\"../living/generated/PageTransitionEvent\");\n\nconst namedPropertiesWindow = require(\"../living/named-properties-window\");\n\nconst postMessage = require(\"../living/post-message\");\n\nconst DOMException = require(\"domexception/webidl2js-wrapper\");\n\nconst {\n  btoa,\n  atob\n} = require(\"abab\");\n\nconst idlUtils = require(\"../living/generated/utils\");\n\nconst WebSocketImpl = require(\"../living/websockets/WebSocket-impl\").implementation;\n\nconst BarProp = require(\"../living/generated/BarProp\");\n\nconst documents = require(\"../living/documents.js\");\n\nconst External = require(\"../living/generated/External\");\n\nconst Navigator = require(\"../living/generated/Navigator\");\n\nconst Performance = require(\"../living/generated/Performance\");\n\nconst Screen = require(\"../living/generated/Screen\");\n\nconst Storage = require(\"../living/generated/Storage\");\n\nconst Selection = require(\"../living/generated/Selection\");\n\nconst reportException = require(\"../living/helpers/runtime-script-errors\");\n\nconst {\n  getCurrentEventHandlerValue\n} = require(\"../living/helpers/create-event-accessor.js\");\n\nconst {\n  fireAnEvent\n} = require(\"../living/helpers/events\");\n\nconst SessionHistory = require(\"../living/window/SessionHistory\");\n\nconst {\n  forEachMatchingSheetRuleOfElement,\n  getResolvedValue,\n  propertiesWithResolvedValueImplemented,\n  SHADOW_DOM_PSEUDO_REGEXP\n} = require(\"../living/helpers/style-rules.js\");\n\nconst CustomElementRegistry = require(\"../living/generated/CustomElementRegistry\");\n\nconst jsGlobals = require(\"./js-globals.json\");\n\nconst GlobalEventHandlersImpl = require(\"../living/nodes/GlobalEventHandlers-impl\").implementation;\n\nconst WindowEventHandlersImpl = require(\"../living/nodes/WindowEventHandlers-impl\").implementation;\n\nconst events = new Set([// GlobalEventHandlers\n\"abort\", \"autocomplete\", \"autocompleteerror\", \"blur\", \"cancel\", \"canplay\", \"canplaythrough\", \"change\", \"click\", \"close\", \"contextmenu\", \"cuechange\", \"dblclick\", \"drag\", \"dragend\", \"dragenter\", \"dragleave\", \"dragover\", \"dragstart\", \"drop\", \"durationchange\", \"emptied\", \"ended\", \"focus\", \"input\", \"invalid\", \"keydown\", \"keypress\", \"keyup\", \"load\", \"loadeddata\", \"loadedmetadata\", \"loadstart\", \"mousedown\", \"mouseenter\", \"mouseleave\", \"mousemove\", \"mouseout\", \"mouseover\", \"mouseup\", \"wheel\", \"pause\", \"play\", \"playing\", \"progress\", \"ratechange\", \"reset\", \"resize\", \"scroll\", \"securitypolicyviolation\", \"seeked\", \"seeking\", \"select\", \"sort\", \"stalled\", \"submit\", \"suspend\", \"timeupdate\", \"toggle\", \"volumechange\", \"waiting\", // WindowEventHandlers\n\"afterprint\", \"beforeprint\", \"hashchange\", \"languagechange\", \"message\", \"messageerror\", \"offline\", \"online\", \"pagehide\", \"pageshow\", \"popstate\", \"rejectionhandled\", \"storage\", \"unhandledrejection\", \"unload\" // \"error\" and \"beforeunload\" are added separately\n]);\n\nexports.createWindow = function (options) {\n  return new Window(options);\n};\n\nconst jsGlobalEntriesToInstall = Object.entries(jsGlobals).filter(_ref => {\n  let [name] = _ref;\n  return name in global;\n}); // TODO remove when we drop Node v10 support.\n\nconst anyNodeVersionQueueMicrotask = typeof queueMicrotask === \"function\" ? queueMicrotask : process.nextTick; // https://html.spec.whatwg.org/#the-window-object\n\nfunction setupWindow(windowInstance, _ref2) {\n  let {\n    runScripts\n  } = _ref2;\n\n  if (runScripts === \"outside-only\" || runScripts === \"dangerously\") {\n    contextifyWindow(windowInstance); // Without this, these globals will only appear to scripts running inside the context using vm.runScript; they will\n    // not appear to scripts running from the outside, including to JSDOM implementation code.\n\n    for (const [globalName, globalPropDesc] of jsGlobalEntriesToInstall) {\n      const propDesc = { ...globalPropDesc,\n        value: vm.runInContext(globalName, windowInstance)\n      };\n      Object.defineProperty(windowInstance, globalName, propDesc);\n    }\n  } else {\n    // Without contextifying the window, none of the globals will exist. So, let's at least alias them from the Node.js\n    // context. See https://github.com/jsdom/jsdom/issues/2727 for more background and discussion.\n    for (const [globalName, globalPropDesc] of jsGlobalEntriesToInstall) {\n      const propDesc = { ...globalPropDesc,\n        value: global[globalName]\n      };\n      Object.defineProperty(windowInstance, globalName, propDesc);\n    }\n  }\n\n  installInterfaces(windowInstance, [\"Window\"]);\n  const EventTargetConstructor = windowInstance.EventTarget; // eslint-disable-next-line func-name-matching, func-style, no-shadow\n\n  const windowConstructor = function Window() {\n    throw new TypeError(\"Illegal constructor\");\n  };\n\n  Object.setPrototypeOf(windowConstructor, EventTargetConstructor);\n  Object.defineProperty(windowInstance, \"Window\", {\n    configurable: true,\n    writable: true,\n    value: windowConstructor\n  });\n  const windowPrototype = Object.create(EventTargetConstructor.prototype);\n  Object.defineProperties(windowPrototype, {\n    constructor: {\n      value: windowConstructor,\n      writable: true,\n      configurable: true\n    },\n    [Symbol.toStringTag]: {\n      value: \"Window\",\n      configurable: true\n    }\n  });\n  windowConstructor.prototype = windowPrototype;\n  Object.setPrototypeOf(windowInstance, windowPrototype);\n  EventTarget.setup(windowInstance, windowInstance);\n  mixin(windowInstance, WindowEventHandlersImpl.prototype);\n  mixin(windowInstance, GlobalEventHandlersImpl.prototype);\n\n  windowInstance._initGlobalEvents();\n\n  Object.defineProperty(windowInstance, \"onbeforeunload\", {\n    configurable: true,\n    enumerable: true,\n\n    get() {\n      return idlUtils.tryWrapperForImpl(getCurrentEventHandlerValue(this, \"beforeunload\"));\n    },\n\n    set(V) {\n      if (!idlUtils.isObject(V)) {\n        V = null;\n      } else {\n        V = OnBeforeUnloadEventHandlerNonNull.convert(V, {\n          context: \"Failed to set the 'onbeforeunload' property on 'Window': The provided value\"\n        });\n      }\n\n      this._setEventHandlerFor(\"beforeunload\", V);\n    }\n\n  });\n  Object.defineProperty(windowInstance, \"onerror\", {\n    configurable: true,\n    enumerable: true,\n\n    get() {\n      return idlUtils.tryWrapperForImpl(getCurrentEventHandlerValue(this, \"error\"));\n    },\n\n    set(V) {\n      if (!idlUtils.isObject(V)) {\n        V = null;\n      } else {\n        V = OnErrorEventHandlerNonNull.convert(V, {\n          context: \"Failed to set the 'onerror' property on 'Window': The provided value\"\n        });\n      }\n\n      this._setEventHandlerFor(\"error\", V);\n    }\n\n  });\n\n  for (const event of events) {\n    Object.defineProperty(windowInstance, `on${event}`, {\n      configurable: true,\n      enumerable: true,\n\n      get() {\n        return idlUtils.tryWrapperForImpl(getCurrentEventHandlerValue(this, event));\n      },\n\n      set(V) {\n        if (!idlUtils.isObject(V)) {\n          V = null;\n        } else {\n          V = EventHandlerNonNull.convert(V, {\n            context: `Failed to set the 'on${event}' property on 'Window': The provided value`\n          });\n        }\n\n        this._setEventHandlerFor(event, V);\n      }\n\n    });\n  }\n\n  windowInstance._globalObject = windowInstance;\n} // NOTE: per https://heycam.github.io/webidl/#Global, all properties on the Window object must be own-properties.\n// That is why we assign everything inside of the constructor, instead of using a shared prototype.\n// You can verify this in e.g. Firefox or Internet Explorer, which do a good job with Web IDL compliance.\n\n\nfunction Window(options) {\n  setupWindow(this, {\n    runScripts: options.runScripts\n  });\n  const rawPerformance = new RawPerformance();\n  const windowInitialized = rawPerformance.now();\n  const window = this; // ### PRIVATE DATA PROPERTIES\n\n  this._resourceLoader = options.resourceLoader; // vm initialization is deferred until script processing is activated\n\n  this._globalProxy = this;\n  Object.defineProperty(idlUtils.implForWrapper(this), idlUtils.wrapperSymbol, {\n    get: () => this._globalProxy\n  }); // List options explicitly to be clear which are passed through\n\n  this._document = documents.createWrapper(window, {\n    parsingMode: options.parsingMode,\n    contentType: options.contentType,\n    encoding: options.encoding,\n    cookieJar: options.cookieJar,\n    url: options.url,\n    lastModified: options.lastModified,\n    referrer: options.referrer,\n    parseOptions: options.parseOptions,\n    defaultView: this._globalProxy,\n    global: this,\n    parentOrigin: options.parentOrigin\n  }, {\n    alwaysUseDocumentClass: true\n  });\n\n  if (vm.isContext(window)) {\n    const documentImpl = idlUtils.implForWrapper(window._document);\n    documentImpl._defaultView = window._globalProxy = vm.runInContext(\"this\", window);\n  }\n\n  const documentOrigin = idlUtils.implForWrapper(this._document)._origin;\n\n  this._origin = documentOrigin; // https://html.spec.whatwg.org/#session-history\n\n  this._sessionHistory = new SessionHistory({\n    document: idlUtils.implForWrapper(this._document),\n    url: idlUtils.implForWrapper(this._document)._URL,\n    stateObject: null\n  }, this);\n  this._virtualConsole = options.virtualConsole;\n  this._runScripts = options.runScripts; // Set up the window as if it's a top level window.\n  // If it's not, then references will be corrected by frame/iframe code.\n\n  this._parent = this._top = this._globalProxy;\n  this._frameElement = null; // This implements window.frames.length, since window.frames returns a\n  // self reference to the window object.  This value is incremented in the\n  // HTMLFrameElement implementation.\n\n  this._length = 0; // https://dom.spec.whatwg.org/#window-current-event\n\n  this._currentEvent = undefined;\n  this._pretendToBeVisual = options.pretendToBeVisual;\n  this._storageQuota = options.storageQuota; // Some properties (such as localStorage and sessionStorage) share data\n  // between windows in the same origin. This object is intended\n  // to contain such data.\n\n  if (options.commonForOrigin && options.commonForOrigin[documentOrigin]) {\n    this._commonForOrigin = options.commonForOrigin;\n  } else {\n    this._commonForOrigin = {\n      [documentOrigin]: {\n        localStorageArea: new Map(),\n        sessionStorageArea: new Map(),\n        windowsInSameOrigin: [this]\n      }\n    };\n  }\n\n  this._currentOriginData = this._commonForOrigin[documentOrigin]; // ### WEB STORAGE\n\n  this._localStorage = Storage.create(window, [], {\n    associatedWindow: this,\n    storageArea: this._currentOriginData.localStorageArea,\n    type: \"localStorage\",\n    url: this._document.documentURI,\n    storageQuota: this._storageQuota\n  });\n  this._sessionStorage = Storage.create(window, [], {\n    associatedWindow: this,\n    storageArea: this._currentOriginData.sessionStorageArea,\n    type: \"sessionStorage\",\n    url: this._document.documentURI,\n    storageQuota: this._storageQuota\n  }); // ### SELECTION\n  // https://w3c.github.io/selection-api/#dfn-selection\n\n  this._selection = Selection.createImpl(window); // https://w3c.github.io/selection-api/#dom-window\n\n  this.getSelection = function () {\n    return window._selection;\n  }; // ### GETTERS\n\n\n  const locationbar = BarProp.create(window);\n  const menubar = BarProp.create(window);\n  const personalbar = BarProp.create(window);\n  const scrollbars = BarProp.create(window);\n  const statusbar = BarProp.create(window);\n  const toolbar = BarProp.create(window);\n  const external = External.create(window);\n  const navigator = Navigator.create(window, [], {\n    userAgent: this._resourceLoader._userAgent\n  });\n  const performance = Performance.create(window, [], {\n    rawPerformance\n  });\n  const screen = Screen.create(window);\n  const customElementRegistry = CustomElementRegistry.create(window);\n  define(this, {\n    get length() {\n      return window._length;\n    },\n\n    get window() {\n      return window._globalProxy;\n    },\n\n    get frameElement() {\n      return idlUtils.wrapperForImpl(window._frameElement);\n    },\n\n    get frames() {\n      return window._globalProxy;\n    },\n\n    get self() {\n      return window._globalProxy;\n    },\n\n    get parent() {\n      return window._parent;\n    },\n\n    get top() {\n      return window._top;\n    },\n\n    get document() {\n      return window._document;\n    },\n\n    get external() {\n      return external;\n    },\n\n    get location() {\n      return idlUtils.wrapperForImpl(idlUtils.implForWrapper(window._document)._location);\n    },\n\n    get history() {\n      return idlUtils.wrapperForImpl(idlUtils.implForWrapper(window._document)._history);\n    },\n\n    get navigator() {\n      return navigator;\n    },\n\n    get locationbar() {\n      return locationbar;\n    },\n\n    get menubar() {\n      return menubar;\n    },\n\n    get personalbar() {\n      return personalbar;\n    },\n\n    get scrollbars() {\n      return scrollbars;\n    },\n\n    get statusbar() {\n      return statusbar;\n    },\n\n    get toolbar() {\n      return toolbar;\n    },\n\n    get performance() {\n      return performance;\n    },\n\n    get screen() {\n      return screen;\n    },\n\n    get origin() {\n      return window._origin;\n    },\n\n    // The origin IDL attribute is defined with [Replaceable].\n    set origin(value) {\n      Object.defineProperty(this, \"origin\", {\n        value,\n        writable: true,\n        enumerable: true,\n        configurable: true\n      });\n    },\n\n    get localStorage() {\n      if (idlUtils.implForWrapper(this._document)._origin === \"null\") {\n        throw DOMException.create(window, [\"localStorage is not available for opaque origins\", \"SecurityError\"]);\n      }\n\n      return this._localStorage;\n    },\n\n    get sessionStorage() {\n      if (idlUtils.implForWrapper(this._document)._origin === \"null\") {\n        throw DOMException.create(window, [\"sessionStorage is not available for opaque origins\", \"SecurityError\"]);\n      }\n\n      return this._sessionStorage;\n    },\n\n    get customElements() {\n      return customElementRegistry;\n    },\n\n    get event() {\n      return window._currentEvent ? idlUtils.wrapperForImpl(window._currentEvent) : undefined;\n    },\n\n    set event(value) {\n      Object.defineProperty(window, \"event\", {\n        configurable: true,\n        enumerable: true,\n        writable: true,\n        value\n      });\n    }\n\n  });\n  namedPropertiesWindow.initializeWindow(this, this._globalProxy); // ### METHODS\n  // https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#timers\n  // In the spec the list of active timers is a set of IDs. We make it a map of IDs to Node.js timer objects, so that\n  // we can call Node.js-side clearTimeout() when clearing, and thus allow process shutdown faster.\n\n  const listOfActiveTimers = new Map();\n  let latestTimerId = 0;\n\n  this.setTimeout = function (handler) {\n    let timeout = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n\n    if (typeof handler !== \"function\") {\n      handler = webIDLConversions.DOMString(handler);\n    }\n\n    timeout = webIDLConversions.long(timeout);\n\n    for (var _len = arguments.length, args = new Array(_len > 2 ? _len - 2 : 0), _key = 2; _key < _len; _key++) {\n      args[_key - 2] = arguments[_key];\n    }\n\n    return timerInitializationSteps(handler, timeout, args, {\n      methodContext: window,\n      repeat: false\n    });\n  };\n\n  this.setInterval = function (handler) {\n    let timeout = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n\n    if (typeof handler !== \"function\") {\n      handler = webIDLConversions.DOMString(handler);\n    }\n\n    timeout = webIDLConversions.long(timeout);\n\n    for (var _len2 = arguments.length, args = new Array(_len2 > 2 ? _len2 - 2 : 0), _key2 = 2; _key2 < _len2; _key2++) {\n      args[_key2 - 2] = arguments[_key2];\n    }\n\n    return timerInitializationSteps(handler, timeout, args, {\n      methodContext: window,\n      repeat: true\n    });\n  };\n\n  this.clearTimeout = function () {\n    let handle = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;\n    handle = webIDLConversions.long(handle);\n    const nodejsTimer = listOfActiveTimers.get(handle);\n\n    if (nodejsTimer) {\n      clearTimeout(nodejsTimer);\n      listOfActiveTimers.delete(handle);\n    }\n  };\n\n  this.clearInterval = function () {\n    let handle = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;\n    handle = webIDLConversions.long(handle);\n    const nodejsTimer = listOfActiveTimers.get(handle);\n\n    if (nodejsTimer) {\n      // We use setTimeout() in timerInitializationSteps even for this.setInterval().\n      clearTimeout(nodejsTimer);\n      listOfActiveTimers.delete(handle);\n    }\n  };\n\n  function timerInitializationSteps(handler, timeout, args, _ref3) {\n    let {\n      methodContext,\n      repeat,\n      previousHandle\n    } = _ref3;\n\n    // This appears to be unspecced, but matches browser behavior for close()ed windows.\n    if (!methodContext._document) {\n      return 0;\n    } // TODO: implement timer nesting level behavior.\n\n\n    const methodContextProxy = methodContext._globalProxy;\n    const handle = previousHandle !== undefined ? previousHandle : ++latestTimerId;\n\n    function task() {\n      if (!listOfActiveTimers.has(handle)) {\n        return;\n      }\n\n      try {\n        if (typeof handler === \"function\") {\n          handler.apply(methodContextProxy, args);\n        } else if (window._runScripts === \"dangerously\") {\n          vm.runInContext(handler, window, {\n            filename: window.location.href,\n            displayErrors: false\n          });\n        }\n      } catch (e) {\n        reportException(window, e, window.location.href);\n      }\n\n      if (listOfActiveTimers.has(handle)) {\n        if (repeat) {\n          timerInitializationSteps(handler, timeout, args, {\n            methodContext,\n            repeat: true,\n            previousHandle: handle\n          });\n        } else {\n          listOfActiveTimers.delete(handle);\n        }\n      }\n    }\n\n    if (timeout < 0) {\n      timeout = 0;\n    }\n\n    const nodejsTimer = setTimeout(task, timeout);\n    listOfActiveTimers.set(handle, nodejsTimer);\n    return handle;\n  } // https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#microtask-queuing\n\n\n  this.queueMicrotask = function (callback) {\n    callback = webIDLConversions.Function(callback);\n    anyNodeVersionQueueMicrotask(() => {\n      try {\n        callback();\n      } catch (e) {\n        reportException(window, e, window.location.href);\n      }\n    });\n  }; // https://html.spec.whatwg.org/multipage/imagebitmap-and-animations.html#animation-frames\n\n\n  let animationFrameCallbackId = 0;\n  const mapOfAnimationFrameCallbacks = new Map();\n  let animationFrameNodejsInterval = null; // Unlike the spec, where an animation frame happens every 60 Hz regardless, we optimize so that if there are no\n  // requestAnimationFrame() calls outstanding, we don't fire the timer. This helps us track that.\n\n  let numberOfOngoingAnimationFrameCallbacks = 0;\n\n  if (this._pretendToBeVisual) {\n    this.requestAnimationFrame = function (callback) {\n      callback = webIDLConversions.Function(callback);\n      const handle = ++animationFrameCallbackId;\n      mapOfAnimationFrameCallbacks.set(handle, callback);\n      ++numberOfOngoingAnimationFrameCallbacks;\n\n      if (numberOfOngoingAnimationFrameCallbacks === 1) {\n        animationFrameNodejsInterval = setInterval(() => {\n          runAnimationFrameCallbacks(rawPerformance.now() - windowInitialized);\n        }, 1000 / 60);\n      }\n\n      return handle;\n    };\n\n    this.cancelAnimationFrame = function (handle) {\n      handle = webIDLConversions[\"unsigned long\"](handle);\n      removeAnimationFrameCallback(handle);\n    };\n\n    function runAnimationFrameCallbacks(now) {\n      // Converting to an array is important to get a sync snapshot and thus match spec semantics.\n      const callbackHandles = [...mapOfAnimationFrameCallbacks.keys()];\n\n      for (const handle of callbackHandles) {\n        // This has() can be false if a callback calls cancelAnimationFrame().\n        if (mapOfAnimationFrameCallbacks.has(handle)) {\n          const callback = mapOfAnimationFrameCallbacks.get(handle);\n          removeAnimationFrameCallback(handle);\n\n          try {\n            callback(now);\n          } catch (e) {\n            reportException(window, e, window.location.href);\n          }\n        }\n      }\n    }\n\n    function removeAnimationFrameCallback(handle) {\n      if (mapOfAnimationFrameCallbacks.has(handle)) {\n        --numberOfOngoingAnimationFrameCallbacks;\n\n        if (numberOfOngoingAnimationFrameCallbacks === 0) {\n          clearInterval(animationFrameNodejsInterval);\n        }\n      }\n\n      mapOfAnimationFrameCallbacks.delete(handle);\n    }\n  }\n\n  function stopAllTimers() {\n    for (const nodejsTimer of listOfActiveTimers.values()) {\n      clearTimeout(nodejsTimer);\n    }\n\n    listOfActiveTimers.clear();\n    clearInterval(animationFrameNodejsInterval);\n  }\n\n  function Option(text, value, defaultSelected, selected) {\n    if (text === undefined) {\n      text = \"\";\n    }\n\n    text = webIDLConversions.DOMString(text);\n\n    if (value !== undefined) {\n      value = webIDLConversions.DOMString(value);\n    }\n\n    defaultSelected = webIDLConversions.boolean(defaultSelected);\n    selected = webIDLConversions.boolean(selected);\n\n    const option = window._document.createElement(\"option\");\n\n    const impl = idlUtils.implForWrapper(option);\n\n    if (text !== \"\") {\n      impl.text = text;\n    }\n\n    if (value !== undefined) {\n      impl.setAttributeNS(null, \"value\", value);\n    }\n\n    if (defaultSelected) {\n      impl.setAttributeNS(null, \"selected\", \"\");\n    }\n\n    impl._selectedness = selected;\n    return option;\n  }\n\n  Object.defineProperty(Option, \"prototype\", {\n    value: this.HTMLOptionElement.prototype,\n    configurable: false,\n    enumerable: false,\n    writable: false\n  });\n  Object.defineProperty(window, \"Option\", {\n    value: Option,\n    configurable: true,\n    enumerable: false,\n    writable: true\n  });\n\n  function Image() {\n    const img = window._document.createElement(\"img\");\n\n    const impl = idlUtils.implForWrapper(img);\n\n    if (arguments.length > 0) {\n      impl.setAttributeNS(null, \"width\", String(arguments.length <= 0 ? undefined : arguments[0]));\n    }\n\n    if (arguments.length > 1) {\n      impl.setAttributeNS(null, \"height\", String(arguments.length <= 1 ? undefined : arguments[1]));\n    }\n\n    return img;\n  }\n\n  Object.defineProperty(Image, \"prototype\", {\n    value: this.HTMLImageElement.prototype,\n    configurable: false,\n    enumerable: false,\n    writable: false\n  });\n  Object.defineProperty(window, \"Image\", {\n    value: Image,\n    configurable: true,\n    enumerable: false,\n    writable: true\n  });\n\n  function Audio(src) {\n    const audio = window._document.createElement(\"audio\");\n\n    const impl = idlUtils.implForWrapper(audio);\n    impl.setAttributeNS(null, \"preload\", \"auto\");\n\n    if (src !== undefined) {\n      impl.setAttributeNS(null, \"src\", String(src));\n    }\n\n    return audio;\n  }\n\n  Object.defineProperty(Audio, \"prototype\", {\n    value: this.HTMLAudioElement.prototype,\n    configurable: false,\n    enumerable: false,\n    writable: false\n  });\n  Object.defineProperty(window, \"Audio\", {\n    value: Audio,\n    configurable: true,\n    enumerable: false,\n    writable: true\n  });\n  this.postMessage = postMessage(window);\n\n  this.atob = function (str) {\n    const result = atob(str);\n\n    if (result === null) {\n      throw DOMException.create(window, [\"The string to be decoded contains invalid characters.\", \"InvalidCharacterError\"]);\n    }\n\n    return result;\n  };\n\n  this.btoa = function (str) {\n    const result = btoa(str);\n\n    if (result === null) {\n      throw DOMException.create(window, [\"The string to be encoded contains invalid characters.\", \"InvalidCharacterError\"]);\n    }\n\n    return result;\n  };\n\n  this.stop = function () {\n    const manager = idlUtils.implForWrapper(this._document)._requestManager;\n\n    if (manager) {\n      manager.close();\n    }\n  };\n\n  this.close = function () {\n    // Recursively close child frame windows, then ourselves (depth-first).\n    for (let i = 0; i < this.length; ++i) {\n      this[i].close();\n    } // Clear out all listeners. Any in-flight or upcoming events should not get delivered.\n\n\n    idlUtils.implForWrapper(this)._eventListeners = Object.create(null);\n\n    if (this._document) {\n      if (this._document.body) {\n        this._document.body.innerHTML = \"\";\n      }\n\n      if (this._document.close) {\n        // It's especially important to clear out the listeners here because document.close() causes a \"load\" event to\n        // fire.\n        idlUtils.implForWrapper(this._document)._eventListeners = Object.create(null);\n\n        this._document.close();\n      }\n\n      const doc = idlUtils.implForWrapper(this._document);\n\n      if (doc._requestManager) {\n        doc._requestManager.close();\n      }\n\n      delete this._document;\n    }\n\n    stopAllTimers();\n    WebSocketImpl.cleanUpWindow(this);\n  };\n\n  this.getComputedStyle = function (elt) {\n    let pseudoElt = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : undefined;\n    elt = Element.convert(elt);\n\n    if (pseudoElt !== undefined && pseudoElt !== null) {\n      pseudoElt = webIDLConversions.DOMString(pseudoElt);\n    }\n\n    if (pseudoElt !== undefined && pseudoElt !== null && pseudoElt !== \"\") {\n      // TODO: Parse pseudoElt\n      if (SHADOW_DOM_PSEUDO_REGEXP.test(pseudoElt)) {\n        throw new TypeError(\"Tried to get the computed style of a Shadow DOM pseudo-element.\");\n      }\n\n      notImplemented(\"window.computedStyle(elt, pseudoElt)\", this);\n    }\n\n    const declaration = new CSSStyleDeclaration();\n    const {\n      forEach\n    } = Array.prototype;\n    const {\n      style\n    } = elt;\n    forEachMatchingSheetRuleOfElement(elt, rule => {\n      forEach.call(rule.style, property => {\n        declaration.setProperty(property, rule.style.getPropertyValue(property), rule.style.getPropertyPriority(property));\n      });\n    }); // https://drafts.csswg.org/cssom/#dom-window-getcomputedstyle\n\n    const declarations = Object.keys(propertiesWithResolvedValueImplemented);\n    forEach.call(declarations, property => {\n      declaration.setProperty(property, getResolvedValue(elt, property));\n    });\n    forEach.call(style, property => {\n      declaration.setProperty(property, style.getPropertyValue(property), style.getPropertyPriority(property));\n    });\n    return declaration;\n  };\n\n  this.getSelection = function () {\n    return window._document.getSelection();\n  }; // The captureEvents() and releaseEvents() methods must do nothing\n\n\n  this.captureEvents = function () {};\n\n  this.releaseEvents = function () {}; // ### PUBLIC DATA PROPERTIES (TODO: should be getters)\n\n\n  function wrapConsoleMethod(method) {\n    return function () {\n      for (var _len3 = arguments.length, args = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {\n        args[_key3] = arguments[_key3];\n      }\n\n      window._virtualConsole.emit(method, ...args);\n    };\n  }\n\n  this.console = {\n    assert: wrapConsoleMethod(\"assert\"),\n    clear: wrapConsoleMethod(\"clear\"),\n    count: wrapConsoleMethod(\"count\"),\n    countReset: wrapConsoleMethod(\"countReset\"),\n    debug: wrapConsoleMethod(\"debug\"),\n    dir: wrapConsoleMethod(\"dir\"),\n    dirxml: wrapConsoleMethod(\"dirxml\"),\n    error: wrapConsoleMethod(\"error\"),\n    group: wrapConsoleMethod(\"group\"),\n    groupCollapsed: wrapConsoleMethod(\"groupCollapsed\"),\n    groupEnd: wrapConsoleMethod(\"groupEnd\"),\n    info: wrapConsoleMethod(\"info\"),\n    log: wrapConsoleMethod(\"log\"),\n    table: wrapConsoleMethod(\"table\"),\n    time: wrapConsoleMethod(\"time\"),\n    timeLog: wrapConsoleMethod(\"timeLog\"),\n    timeEnd: wrapConsoleMethod(\"timeEnd\"),\n    trace: wrapConsoleMethod(\"trace\"),\n    warn: wrapConsoleMethod(\"warn\")\n  };\n\n  function notImplementedMethod(name) {\n    return function () {\n      notImplemented(name, window);\n    };\n  }\n\n  define(this, {\n    name: \"\",\n    status: \"\",\n    devicePixelRatio: 1,\n    innerWidth: 1024,\n    innerHeight: 768,\n    outerWidth: 1024,\n    outerHeight: 768,\n    pageXOffset: 0,\n    pageYOffset: 0,\n    screenX: 0,\n    screenLeft: 0,\n    screenY: 0,\n    screenTop: 0,\n    scrollX: 0,\n    scrollY: 0,\n    alert: notImplementedMethod(\"window.alert\"),\n    blur: notImplementedMethod(\"window.blur\"),\n    confirm: notImplementedMethod(\"window.confirm\"),\n    focus: notImplementedMethod(\"window.focus\"),\n    moveBy: notImplementedMethod(\"window.moveBy\"),\n    moveTo: notImplementedMethod(\"window.moveTo\"),\n    open: notImplementedMethod(\"window.open\"),\n    print: notImplementedMethod(\"window.print\"),\n    prompt: notImplementedMethod(\"window.prompt\"),\n    resizeBy: notImplementedMethod(\"window.resizeBy\"),\n    resizeTo: notImplementedMethod(\"window.resizeTo\"),\n    scroll: notImplementedMethod(\"window.scroll\"),\n    scrollBy: notImplementedMethod(\"window.scrollBy\"),\n    scrollTo: notImplementedMethod(\"window.scrollTo\")\n  }); // ### INITIALIZATION\n\n  process.nextTick(() => {\n    if (!window.document) {\n      return; // window might've been closed already\n    }\n\n    const documentImpl = idlUtils.implForWrapper(window._document);\n\n    if (window.document.readyState === \"complete\") {\n      fireAnEvent(\"load\", window, undefined, {}, documentImpl);\n    } else {\n      window.document.addEventListener(\"load\", () => {\n        fireAnEvent(\"load\", window, undefined, {}, documentImpl);\n\n        if (!documentImpl._pageShowingFlag) {\n          documentImpl._pageShowingFlag = true;\n          fireAnEvent(\"pageshow\", window, PageTransitionEvent, {\n            persisted: false\n          }, documentImpl);\n        }\n      });\n    }\n  });\n}\n\nfunction contextifyWindow(window) {\n  if (vm.isContext(window)) {\n    return;\n  }\n\n  vm.createContext(window);\n}","map":{"version":3,"names":["vm","require","webIDLConversions","CSSStyleDeclaration","Performance","RawPerformance","notImplemented","installInterfaces","define","mixin","Element","EventTarget","EventHandlerNonNull","OnBeforeUnloadEventHandlerNonNull","OnErrorEventHandlerNonNull","PageTransitionEvent","namedPropertiesWindow","postMessage","DOMException","btoa","atob","idlUtils","WebSocketImpl","implementation","BarProp","documents","External","Navigator","Screen","Storage","Selection","reportException","getCurrentEventHandlerValue","fireAnEvent","SessionHistory","forEachMatchingSheetRuleOfElement","getResolvedValue","propertiesWithResolvedValueImplemented","SHADOW_DOM_PSEUDO_REGEXP","CustomElementRegistry","jsGlobals","GlobalEventHandlersImpl","WindowEventHandlersImpl","events","Set","exports","createWindow","options","Window","jsGlobalEntriesToInstall","Object","entries","filter","name","global","anyNodeVersionQueueMicrotask","queueMicrotask","process","nextTick","setupWindow","windowInstance","runScripts","contextifyWindow","globalName","globalPropDesc","propDesc","value","runInContext","defineProperty","EventTargetConstructor","windowConstructor","TypeError","setPrototypeOf","configurable","writable","windowPrototype","create","prototype","defineProperties","constructor","Symbol","toStringTag","setup","_initGlobalEvents","enumerable","get","tryWrapperForImpl","set","V","isObject","convert","context","_setEventHandlerFor","event","_globalObject","rawPerformance","windowInitialized","now","window","_resourceLoader","resourceLoader","_globalProxy","implForWrapper","wrapperSymbol","_document","createWrapper","parsingMode","contentType","encoding","cookieJar","url","lastModified","referrer","parseOptions","defaultView","parentOrigin","alwaysUseDocumentClass","isContext","documentImpl","_defaultView","documentOrigin","_origin","_sessionHistory","document","_URL","stateObject","_virtualConsole","virtualConsole","_runScripts","_parent","_top","_frameElement","_length","_currentEvent","undefined","_pretendToBeVisual","pretendToBeVisual","_storageQuota","storageQuota","commonForOrigin","_commonForOrigin","localStorageArea","Map","sessionStorageArea","windowsInSameOrigin","_currentOriginData","_localStorage","associatedWindow","storageArea","type","documentURI","_sessionStorage","_selection","createImpl","getSelection","locationbar","menubar","personalbar","scrollbars","statusbar","toolbar","external","navigator","userAgent","_userAgent","performance","screen","customElementRegistry","length","frameElement","wrapperForImpl","frames","self","parent","top","location","_location","history","_history","origin","localStorage","sessionStorage","customElements","initializeWindow","listOfActiveTimers","latestTimerId","setTimeout","handler","timeout","DOMString","long","args","timerInitializationSteps","methodContext","repeat","setInterval","clearTimeout","handle","nodejsTimer","delete","clearInterval","previousHandle","methodContextProxy","task","has","apply","filename","href","displayErrors","e","callback","Function","animationFrameCallbackId","mapOfAnimationFrameCallbacks","animationFrameNodejsInterval","numberOfOngoingAnimationFrameCallbacks","requestAnimationFrame","runAnimationFrameCallbacks","cancelAnimationFrame","removeAnimationFrameCallback","callbackHandles","keys","stopAllTimers","values","clear","Option","text","defaultSelected","selected","boolean","option","createElement","impl","setAttributeNS","_selectedness","HTMLOptionElement","Image","img","String","HTMLImageElement","Audio","src","audio","HTMLAudioElement","str","result","stop","manager","_requestManager","close","i","_eventListeners","body","innerHTML","doc","cleanUpWindow","getComputedStyle","elt","pseudoElt","test","declaration","forEach","Array","style","rule","call","property","setProperty","getPropertyValue","getPropertyPriority","declarations","captureEvents","releaseEvents","wrapConsoleMethod","method","emit","console","assert","count","countReset","debug","dir","dirxml","error","group","groupCollapsed","groupEnd","info","log","table","time","timeLog","timeEnd","trace","warn","notImplementedMethod","status","devicePixelRatio","innerWidth","innerHeight","outerWidth","outerHeight","pageXOffset","pageYOffset","screenX","screenLeft","screenY","screenTop","scrollX","scrollY","alert","blur","confirm","focus","moveBy","moveTo","open","print","prompt","resizeBy","resizeTo","scroll","scrollBy","scrollTo","readyState","addEventListener","_pageShowingFlag","persisted","createContext"],"sources":["C:/Users/17033/balmco/node_modules/jsdom/lib/jsdom/browser/Window.js"],"sourcesContent":["\"use strict\";\nconst vm = require(\"vm\");\nconst webIDLConversions = require(\"webidl-conversions\");\nconst { CSSStyleDeclaration } = require(\"cssstyle\");\nconst { Performance: RawPerformance } = require(\"w3c-hr-time\");\nconst notImplemented = require(\"./not-implemented\");\nconst { installInterfaces } = require(\"../living/interfaces\");\nconst { define, mixin } = require(\"../utils\");\nconst Element = require(\"../living/generated/Element\");\nconst EventTarget = require(\"../living/generated/EventTarget\");\nconst EventHandlerNonNull = require(\"../living/generated/EventHandlerNonNull\");\nconst OnBeforeUnloadEventHandlerNonNull = require(\"../living/generated/OnBeforeUnloadEventHandlerNonNull\");\nconst OnErrorEventHandlerNonNull = require(\"../living/generated/OnErrorEventHandlerNonNull\");\nconst PageTransitionEvent = require(\"../living/generated/PageTransitionEvent\");\nconst namedPropertiesWindow = require(\"../living/named-properties-window\");\nconst postMessage = require(\"../living/post-message\");\nconst DOMException = require(\"domexception/webidl2js-wrapper\");\nconst { btoa, atob } = require(\"abab\");\nconst idlUtils = require(\"../living/generated/utils\");\nconst WebSocketImpl = require(\"../living/websockets/WebSocket-impl\").implementation;\nconst BarProp = require(\"../living/generated/BarProp\");\nconst documents = require(\"../living/documents.js\");\nconst External = require(\"../living/generated/External\");\nconst Navigator = require(\"../living/generated/Navigator\");\nconst Performance = require(\"../living/generated/Performance\");\nconst Screen = require(\"../living/generated/Screen\");\nconst Storage = require(\"../living/generated/Storage\");\nconst Selection = require(\"../living/generated/Selection\");\nconst reportException = require(\"../living/helpers/runtime-script-errors\");\nconst { getCurrentEventHandlerValue } = require(\"../living/helpers/create-event-accessor.js\");\nconst { fireAnEvent } = require(\"../living/helpers/events\");\nconst SessionHistory = require(\"../living/window/SessionHistory\");\nconst { forEachMatchingSheetRuleOfElement, getResolvedValue, propertiesWithResolvedValueImplemented,\n  SHADOW_DOM_PSEUDO_REGEXP } = require(\"../living/helpers/style-rules.js\");\nconst CustomElementRegistry = require(\"../living/generated/CustomElementRegistry\");\nconst jsGlobals = require(\"./js-globals.json\");\n\nconst GlobalEventHandlersImpl = require(\"../living/nodes/GlobalEventHandlers-impl\").implementation;\nconst WindowEventHandlersImpl = require(\"../living/nodes/WindowEventHandlers-impl\").implementation;\n\nconst events = new Set([\n  // GlobalEventHandlers\n  \"abort\", \"autocomplete\",\n  \"autocompleteerror\", \"blur\",\n  \"cancel\", \"canplay\", \"canplaythrough\",\n  \"change\", \"click\",\n  \"close\", \"contextmenu\",\n  \"cuechange\", \"dblclick\",\n  \"drag\", \"dragend\",\n  \"dragenter\",\n  \"dragleave\", \"dragover\",\n  \"dragstart\", \"drop\",\n  \"durationchange\", \"emptied\",\n  \"ended\", \"focus\",\n  \"input\", \"invalid\",\n  \"keydown\", \"keypress\",\n  \"keyup\", \"load\", \"loadeddata\",\n  \"loadedmetadata\", \"loadstart\",\n  \"mousedown\", \"mouseenter\",\n  \"mouseleave\", \"mousemove\",\n  \"mouseout\", \"mouseover\",\n  \"mouseup\", \"wheel\",\n  \"pause\", \"play\",\n  \"playing\", \"progress\",\n  \"ratechange\", \"reset\",\n  \"resize\", \"scroll\",\n  \"securitypolicyviolation\",\n  \"seeked\", \"seeking\",\n  \"select\", \"sort\", \"stalled\",\n  \"submit\", \"suspend\",\n  \"timeupdate\", \"toggle\",\n  \"volumechange\", \"waiting\",\n\n  // WindowEventHandlers\n  \"afterprint\",\n  \"beforeprint\",\n  \"hashchange\",\n  \"languagechange\",\n  \"message\",\n  \"messageerror\",\n  \"offline\",\n  \"online\",\n  \"pagehide\",\n  \"pageshow\",\n  \"popstate\",\n  \"rejectionhandled\",\n  \"storage\",\n  \"unhandledrejection\",\n  \"unload\"\n\n  // \"error\" and \"beforeunload\" are added separately\n]);\n\nexports.createWindow = function (options) {\n  return new Window(options);\n};\n\nconst jsGlobalEntriesToInstall = Object.entries(jsGlobals).filter(([name]) => name in global);\n\n// TODO remove when we drop Node v10 support.\nconst anyNodeVersionQueueMicrotask = typeof queueMicrotask === \"function\" ? queueMicrotask : process.nextTick;\n\n// https://html.spec.whatwg.org/#the-window-object\nfunction setupWindow(windowInstance, { runScripts }) {\n  if (runScripts === \"outside-only\" || runScripts === \"dangerously\") {\n    contextifyWindow(windowInstance);\n\n    // Without this, these globals will only appear to scripts running inside the context using vm.runScript; they will\n    // not appear to scripts running from the outside, including to JSDOM implementation code.\n    for (const [globalName, globalPropDesc] of jsGlobalEntriesToInstall) {\n      const propDesc = { ...globalPropDesc, value: vm.runInContext(globalName, windowInstance) };\n      Object.defineProperty(windowInstance, globalName, propDesc);\n    }\n  } else {\n    // Without contextifying the window, none of the globals will exist. So, let's at least alias them from the Node.js\n    // context. See https://github.com/jsdom/jsdom/issues/2727 for more background and discussion.\n    for (const [globalName, globalPropDesc] of jsGlobalEntriesToInstall) {\n      const propDesc = { ...globalPropDesc, value: global[globalName] };\n      Object.defineProperty(windowInstance, globalName, propDesc);\n    }\n  }\n\n  installInterfaces(windowInstance, [\"Window\"]);\n\n  const EventTargetConstructor = windowInstance.EventTarget;\n\n  // eslint-disable-next-line func-name-matching, func-style, no-shadow\n  const windowConstructor = function Window() {\n    throw new TypeError(\"Illegal constructor\");\n  };\n  Object.setPrototypeOf(windowConstructor, EventTargetConstructor);\n\n  Object.defineProperty(windowInstance, \"Window\", {\n    configurable: true,\n    writable: true,\n    value: windowConstructor\n  });\n\n  const windowPrototype = Object.create(EventTargetConstructor.prototype);\n  Object.defineProperties(windowPrototype, {\n    constructor: {\n      value: windowConstructor,\n      writable: true,\n      configurable: true\n    },\n    [Symbol.toStringTag]: {\n      value: \"Window\",\n      configurable: true\n    }\n  });\n\n  windowConstructor.prototype = windowPrototype;\n  Object.setPrototypeOf(windowInstance, windowPrototype);\n\n  EventTarget.setup(windowInstance, windowInstance);\n  mixin(windowInstance, WindowEventHandlersImpl.prototype);\n  mixin(windowInstance, GlobalEventHandlersImpl.prototype);\n  windowInstance._initGlobalEvents();\n\n  Object.defineProperty(windowInstance, \"onbeforeunload\", {\n    configurable: true,\n    enumerable: true,\n    get() {\n      return idlUtils.tryWrapperForImpl(getCurrentEventHandlerValue(this, \"beforeunload\"));\n    },\n    set(V) {\n      if (!idlUtils.isObject(V)) {\n        V = null;\n      } else {\n        V = OnBeforeUnloadEventHandlerNonNull.convert(V, {\n          context: \"Failed to set the 'onbeforeunload' property on 'Window': The provided value\"\n        });\n      }\n      this._setEventHandlerFor(\"beforeunload\", V);\n    }\n  });\n\n  Object.defineProperty(windowInstance, \"onerror\", {\n    configurable: true,\n    enumerable: true,\n    get() {\n      return idlUtils.tryWrapperForImpl(getCurrentEventHandlerValue(this, \"error\"));\n    },\n    set(V) {\n      if (!idlUtils.isObject(V)) {\n        V = null;\n      } else {\n        V = OnErrorEventHandlerNonNull.convert(V, {\n          context: \"Failed to set the 'onerror' property on 'Window': The provided value\"\n        });\n      }\n      this._setEventHandlerFor(\"error\", V);\n    }\n  });\n\n  for (const event of events) {\n    Object.defineProperty(windowInstance, `on${event}`, {\n      configurable: true,\n      enumerable: true,\n      get() {\n        return idlUtils.tryWrapperForImpl(getCurrentEventHandlerValue(this, event));\n      },\n      set(V) {\n        if (!idlUtils.isObject(V)) {\n          V = null;\n        } else {\n          V = EventHandlerNonNull.convert(V, {\n            context: `Failed to set the 'on${event}' property on 'Window': The provided value`\n          });\n        }\n        this._setEventHandlerFor(event, V);\n      }\n    });\n  }\n\n  windowInstance._globalObject = windowInstance;\n}\n\n// NOTE: per https://heycam.github.io/webidl/#Global, all properties on the Window object must be own-properties.\n// That is why we assign everything inside of the constructor, instead of using a shared prototype.\n// You can verify this in e.g. Firefox or Internet Explorer, which do a good job with Web IDL compliance.\nfunction Window(options) {\n  setupWindow(this, { runScripts: options.runScripts });\n\n  const rawPerformance = new RawPerformance();\n  const windowInitialized = rawPerformance.now();\n\n  const window = this;\n\n  // ### PRIVATE DATA PROPERTIES\n\n  this._resourceLoader = options.resourceLoader;\n\n  // vm initialization is deferred until script processing is activated\n  this._globalProxy = this;\n  Object.defineProperty(idlUtils.implForWrapper(this), idlUtils.wrapperSymbol, { get: () => this._globalProxy });\n\n  // List options explicitly to be clear which are passed through\n  this._document = documents.createWrapper(window, {\n    parsingMode: options.parsingMode,\n    contentType: options.contentType,\n    encoding: options.encoding,\n    cookieJar: options.cookieJar,\n    url: options.url,\n    lastModified: options.lastModified,\n    referrer: options.referrer,\n    parseOptions: options.parseOptions,\n    defaultView: this._globalProxy,\n    global: this,\n    parentOrigin: options.parentOrigin\n  }, { alwaysUseDocumentClass: true });\n\n  if (vm.isContext(window)) {\n    const documentImpl = idlUtils.implForWrapper(window._document);\n    documentImpl._defaultView = window._globalProxy = vm.runInContext(\"this\", window);\n  }\n\n  const documentOrigin = idlUtils.implForWrapper(this._document)._origin;\n  this._origin = documentOrigin;\n\n  // https://html.spec.whatwg.org/#session-history\n  this._sessionHistory = new SessionHistory({\n    document: idlUtils.implForWrapper(this._document),\n    url: idlUtils.implForWrapper(this._document)._URL,\n    stateObject: null\n  }, this);\n\n  this._virtualConsole = options.virtualConsole;\n\n  this._runScripts = options.runScripts;\n\n  // Set up the window as if it's a top level window.\n  // If it's not, then references will be corrected by frame/iframe code.\n  this._parent = this._top = this._globalProxy;\n  this._frameElement = null;\n\n  // This implements window.frames.length, since window.frames returns a\n  // self reference to the window object.  This value is incremented in the\n  // HTMLFrameElement implementation.\n  this._length = 0;\n\n  // https://dom.spec.whatwg.org/#window-current-event\n  this._currentEvent = undefined;\n\n  this._pretendToBeVisual = options.pretendToBeVisual;\n  this._storageQuota = options.storageQuota;\n\n  // Some properties (such as localStorage and sessionStorage) share data\n  // between windows in the same origin. This object is intended\n  // to contain such data.\n  if (options.commonForOrigin && options.commonForOrigin[documentOrigin]) {\n    this._commonForOrigin = options.commonForOrigin;\n  } else {\n    this._commonForOrigin = {\n      [documentOrigin]: {\n        localStorageArea: new Map(),\n        sessionStorageArea: new Map(),\n        windowsInSameOrigin: [this]\n      }\n    };\n  }\n\n  this._currentOriginData = this._commonForOrigin[documentOrigin];\n\n  // ### WEB STORAGE\n\n  this._localStorage = Storage.create(window, [], {\n    associatedWindow: this,\n    storageArea: this._currentOriginData.localStorageArea,\n    type: \"localStorage\",\n    url: this._document.documentURI,\n    storageQuota: this._storageQuota\n  });\n  this._sessionStorage = Storage.create(window, [], {\n    associatedWindow: this,\n    storageArea: this._currentOriginData.sessionStorageArea,\n    type: \"sessionStorage\",\n    url: this._document.documentURI,\n    storageQuota: this._storageQuota\n  });\n\n  // ### SELECTION\n\n  // https://w3c.github.io/selection-api/#dfn-selection\n  this._selection = Selection.createImpl(window);\n\n  // https://w3c.github.io/selection-api/#dom-window\n  this.getSelection = function () {\n    return window._selection;\n  };\n\n  // ### GETTERS\n\n  const locationbar = BarProp.create(window);\n  const menubar = BarProp.create(window);\n  const personalbar = BarProp.create(window);\n  const scrollbars = BarProp.create(window);\n  const statusbar = BarProp.create(window);\n  const toolbar = BarProp.create(window);\n  const external = External.create(window);\n  const navigator = Navigator.create(window, [], { userAgent: this._resourceLoader._userAgent });\n  const performance = Performance.create(window, [], { rawPerformance });\n  const screen = Screen.create(window);\n  const customElementRegistry = CustomElementRegistry.create(window);\n\n  define(this, {\n    get length() {\n      return window._length;\n    },\n    get window() {\n      return window._globalProxy;\n    },\n    get frameElement() {\n      return idlUtils.wrapperForImpl(window._frameElement);\n    },\n    get frames() {\n      return window._globalProxy;\n    },\n    get self() {\n      return window._globalProxy;\n    },\n    get parent() {\n      return window._parent;\n    },\n    get top() {\n      return window._top;\n    },\n    get document() {\n      return window._document;\n    },\n    get external() {\n      return external;\n    },\n    get location() {\n      return idlUtils.wrapperForImpl(idlUtils.implForWrapper(window._document)._location);\n    },\n    get history() {\n      return idlUtils.wrapperForImpl(idlUtils.implForWrapper(window._document)._history);\n    },\n    get navigator() {\n      return navigator;\n    },\n    get locationbar() {\n      return locationbar;\n    },\n    get menubar() {\n      return menubar;\n    },\n    get personalbar() {\n      return personalbar;\n    },\n    get scrollbars() {\n      return scrollbars;\n    },\n    get statusbar() {\n      return statusbar;\n    },\n    get toolbar() {\n      return toolbar;\n    },\n    get performance() {\n      return performance;\n    },\n    get screen() {\n      return screen;\n    },\n    get origin() {\n      return window._origin;\n    },\n    // The origin IDL attribute is defined with [Replaceable].\n    set origin(value) {\n      Object.defineProperty(this, \"origin\", {\n        value,\n        writable: true,\n        enumerable: true,\n        configurable: true\n      });\n    },\n    get localStorage() {\n      if (idlUtils.implForWrapper(this._document)._origin === \"null\") {\n        throw DOMException.create(window, [\n          \"localStorage is not available for opaque origins\",\n          \"SecurityError\"\n        ]);\n      }\n\n      return this._localStorage;\n    },\n    get sessionStorage() {\n      if (idlUtils.implForWrapper(this._document)._origin === \"null\") {\n        throw DOMException.create(window, [\n          \"sessionStorage is not available for opaque origins\",\n          \"SecurityError\"\n        ]);\n      }\n\n      return this._sessionStorage;\n    },\n    get customElements() {\n      return customElementRegistry;\n    },\n    get event() {\n      return window._currentEvent ? idlUtils.wrapperForImpl(window._currentEvent) : undefined;\n    },\n    set event(value) {\n      Object.defineProperty(window, \"event\", { configurable: true, enumerable: true, writable: true, value });\n    }\n  });\n\n  namedPropertiesWindow.initializeWindow(this, this._globalProxy);\n\n  // ### METHODS\n\n  // https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#timers\n\n  // In the spec the list of active timers is a set of IDs. We make it a map of IDs to Node.js timer objects, so that\n  // we can call Node.js-side clearTimeout() when clearing, and thus allow process shutdown faster.\n  const listOfActiveTimers = new Map();\n  let latestTimerId = 0;\n\n  this.setTimeout = function (handler, timeout = 0, ...args) {\n    if (typeof handler !== \"function\") {\n      handler = webIDLConversions.DOMString(handler);\n    }\n    timeout = webIDLConversions.long(timeout);\n\n    return timerInitializationSteps(handler, timeout, args, { methodContext: window, repeat: false });\n  };\n  this.setInterval = function (handler, timeout = 0, ...args) {\n    if (typeof handler !== \"function\") {\n      handler = webIDLConversions.DOMString(handler);\n    }\n    timeout = webIDLConversions.long(timeout);\n\n    return timerInitializationSteps(handler, timeout, args, { methodContext: window, repeat: true });\n  };\n\n  this.clearTimeout = function (handle = 0) {\n    handle = webIDLConversions.long(handle);\n\n    const nodejsTimer = listOfActiveTimers.get(handle);\n    if (nodejsTimer) {\n      clearTimeout(nodejsTimer);\n      listOfActiveTimers.delete(handle);\n    }\n  };\n  this.clearInterval = function (handle = 0) {\n    handle = webIDLConversions.long(handle);\n\n    const nodejsTimer = listOfActiveTimers.get(handle);\n    if (nodejsTimer) {\n      // We use setTimeout() in timerInitializationSteps even for this.setInterval().\n      clearTimeout(nodejsTimer);\n      listOfActiveTimers.delete(handle);\n    }\n  };\n\n  function timerInitializationSteps(handler, timeout, args, { methodContext, repeat, previousHandle }) {\n    // This appears to be unspecced, but matches browser behavior for close()ed windows.\n    if (!methodContext._document) {\n      return 0;\n    }\n\n    // TODO: implement timer nesting level behavior.\n\n    const methodContextProxy = methodContext._globalProxy;\n    const handle = previousHandle !== undefined ? previousHandle : ++latestTimerId;\n\n    function task() {\n      if (!listOfActiveTimers.has(handle)) {\n        return;\n      }\n\n      try {\n        if (typeof handler === \"function\") {\n          handler.apply(methodContextProxy, args);\n        } else if (window._runScripts === \"dangerously\") {\n          vm.runInContext(handler, window, { filename: window.location.href, displayErrors: false });\n        }\n      } catch (e) {\n        reportException(window, e, window.location.href);\n      }\n\n      if (listOfActiveTimers.has(handle)) {\n        if (repeat) {\n          timerInitializationSteps(handler, timeout, args, { methodContext, repeat: true, previousHandle: handle });\n        } else {\n          listOfActiveTimers.delete(handle);\n        }\n      }\n    }\n\n    if (timeout < 0) {\n      timeout = 0;\n    }\n\n    const nodejsTimer = setTimeout(task, timeout);\n    listOfActiveTimers.set(handle, nodejsTimer);\n\n    return handle;\n  }\n\n  // https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#microtask-queuing\n\n  this.queueMicrotask = function (callback) {\n    callback = webIDLConversions.Function(callback);\n\n    anyNodeVersionQueueMicrotask(() => {\n      try {\n        callback();\n      } catch (e) {\n        reportException(window, e, window.location.href);\n      }\n    });\n  };\n\n  // https://html.spec.whatwg.org/multipage/imagebitmap-and-animations.html#animation-frames\n\n  let animationFrameCallbackId = 0;\n  const mapOfAnimationFrameCallbacks = new Map();\n  let animationFrameNodejsInterval = null;\n\n  // Unlike the spec, where an animation frame happens every 60 Hz regardless, we optimize so that if there are no\n  // requestAnimationFrame() calls outstanding, we don't fire the timer. This helps us track that.\n  let numberOfOngoingAnimationFrameCallbacks = 0;\n\n  if (this._pretendToBeVisual) {\n    this.requestAnimationFrame = function (callback) {\n      callback = webIDLConversions.Function(callback);\n\n      const handle = ++animationFrameCallbackId;\n      mapOfAnimationFrameCallbacks.set(handle, callback);\n\n      ++numberOfOngoingAnimationFrameCallbacks;\n      if (numberOfOngoingAnimationFrameCallbacks === 1) {\n        animationFrameNodejsInterval = setInterval(() => {\n          runAnimationFrameCallbacks(rawPerformance.now() - windowInitialized);\n        }, 1000 / 60);\n      }\n\n      return handle;\n    };\n\n    this.cancelAnimationFrame = function (handle) {\n      handle = webIDLConversions[\"unsigned long\"](handle);\n\n      removeAnimationFrameCallback(handle);\n    };\n\n    function runAnimationFrameCallbacks(now) {\n      // Converting to an array is important to get a sync snapshot and thus match spec semantics.\n      const callbackHandles = [...mapOfAnimationFrameCallbacks.keys()];\n      for (const handle of callbackHandles) {\n        // This has() can be false if a callback calls cancelAnimationFrame().\n        if (mapOfAnimationFrameCallbacks.has(handle)) {\n          const callback = mapOfAnimationFrameCallbacks.get(handle);\n          removeAnimationFrameCallback(handle);\n          try {\n            callback(now);\n          } catch (e) {\n            reportException(window, e, window.location.href);\n          }\n        }\n      }\n    }\n\n    function removeAnimationFrameCallback(handle) {\n      if (mapOfAnimationFrameCallbacks.has(handle)) {\n        --numberOfOngoingAnimationFrameCallbacks;\n        if (numberOfOngoingAnimationFrameCallbacks === 0) {\n          clearInterval(animationFrameNodejsInterval);\n        }\n      }\n\n      mapOfAnimationFrameCallbacks.delete(handle);\n    }\n  }\n\n  function stopAllTimers() {\n    for (const nodejsTimer of listOfActiveTimers.values()) {\n      clearTimeout(nodejsTimer);\n    }\n    listOfActiveTimers.clear();\n\n    clearInterval(animationFrameNodejsInterval);\n  }\n\n  function Option(text, value, defaultSelected, selected) {\n    if (text === undefined) {\n      text = \"\";\n    }\n    text = webIDLConversions.DOMString(text);\n\n    if (value !== undefined) {\n      value = webIDLConversions.DOMString(value);\n    }\n\n    defaultSelected = webIDLConversions.boolean(defaultSelected);\n    selected = webIDLConversions.boolean(selected);\n\n    const option = window._document.createElement(\"option\");\n    const impl = idlUtils.implForWrapper(option);\n\n    if (text !== \"\") {\n      impl.text = text;\n    }\n    if (value !== undefined) {\n      impl.setAttributeNS(null, \"value\", value);\n    }\n    if (defaultSelected) {\n      impl.setAttributeNS(null, \"selected\", \"\");\n    }\n    impl._selectedness = selected;\n\n    return option;\n  }\n  Object.defineProperty(Option, \"prototype\", {\n    value: this.HTMLOptionElement.prototype,\n    configurable: false,\n    enumerable: false,\n    writable: false\n  });\n  Object.defineProperty(window, \"Option\", {\n    value: Option,\n    configurable: true,\n    enumerable: false,\n    writable: true\n  });\n\n  function Image(...args) {\n    const img = window._document.createElement(\"img\");\n    const impl = idlUtils.implForWrapper(img);\n\n    if (args.length > 0) {\n      impl.setAttributeNS(null, \"width\", String(args[0]));\n    }\n    if (args.length > 1) {\n      impl.setAttributeNS(null, \"height\", String(args[1]));\n    }\n\n    return img;\n  }\n  Object.defineProperty(Image, \"prototype\", {\n    value: this.HTMLImageElement.prototype,\n    configurable: false,\n    enumerable: false,\n    writable: false\n  });\n  Object.defineProperty(window, \"Image\", {\n    value: Image,\n    configurable: true,\n    enumerable: false,\n    writable: true\n  });\n\n  function Audio(src) {\n    const audio = window._document.createElement(\"audio\");\n    const impl = idlUtils.implForWrapper(audio);\n    impl.setAttributeNS(null, \"preload\", \"auto\");\n\n    if (src !== undefined) {\n      impl.setAttributeNS(null, \"src\", String(src));\n    }\n\n    return audio;\n  }\n  Object.defineProperty(Audio, \"prototype\", {\n    value: this.HTMLAudioElement.prototype,\n    configurable: false,\n    enumerable: false,\n    writable: false\n  });\n  Object.defineProperty(window, \"Audio\", {\n    value: Audio,\n    configurable: true,\n    enumerable: false,\n    writable: true\n  });\n\n  this.postMessage = postMessage(window);\n\n  this.atob = function (str) {\n    const result = atob(str);\n    if (result === null) {\n      throw DOMException.create(window, [\n        \"The string to be decoded contains invalid characters.\",\n        \"InvalidCharacterError\"\n      ]);\n    }\n    return result;\n  };\n\n  this.btoa = function (str) {\n    const result = btoa(str);\n    if (result === null) {\n      throw DOMException.create(window, [\n        \"The string to be encoded contains invalid characters.\",\n        \"InvalidCharacterError\"\n      ]);\n    }\n    return result;\n  };\n\n  this.stop = function () {\n    const manager = idlUtils.implForWrapper(this._document)._requestManager;\n    if (manager) {\n      manager.close();\n    }\n  };\n\n  this.close = function () {\n    // Recursively close child frame windows, then ourselves (depth-first).\n    for (let i = 0; i < this.length; ++i) {\n      this[i].close();\n    }\n\n    // Clear out all listeners. Any in-flight or upcoming events should not get delivered.\n    idlUtils.implForWrapper(this)._eventListeners = Object.create(null);\n\n    if (this._document) {\n      if (this._document.body) {\n        this._document.body.innerHTML = \"\";\n      }\n\n      if (this._document.close) {\n        // It's especially important to clear out the listeners here because document.close() causes a \"load\" event to\n        // fire.\n        idlUtils.implForWrapper(this._document)._eventListeners = Object.create(null);\n        this._document.close();\n      }\n      const doc = idlUtils.implForWrapper(this._document);\n      if (doc._requestManager) {\n        doc._requestManager.close();\n      }\n      delete this._document;\n    }\n\n    stopAllTimers();\n    WebSocketImpl.cleanUpWindow(this);\n  };\n\n  this.getComputedStyle = function (elt, pseudoElt = undefined) {\n    elt = Element.convert(elt);\n    if (pseudoElt !== undefined && pseudoElt !== null) {\n      pseudoElt = webIDLConversions.DOMString(pseudoElt);\n    }\n\n    if (pseudoElt !== undefined && pseudoElt !== null && pseudoElt !== \"\") {\n      // TODO: Parse pseudoElt\n\n      if (SHADOW_DOM_PSEUDO_REGEXP.test(pseudoElt)) {\n        throw new TypeError(\"Tried to get the computed style of a Shadow DOM pseudo-element.\");\n      }\n\n      notImplemented(\"window.computedStyle(elt, pseudoElt)\", this);\n    }\n\n    const declaration = new CSSStyleDeclaration();\n    const { forEach } = Array.prototype;\n    const { style } = elt;\n\n    forEachMatchingSheetRuleOfElement(elt, rule => {\n      forEach.call(rule.style, property => {\n        declaration.setProperty(\n          property,\n          rule.style.getPropertyValue(property),\n          rule.style.getPropertyPriority(property)\n        );\n      });\n    });\n\n    // https://drafts.csswg.org/cssom/#dom-window-getcomputedstyle\n    const declarations = Object.keys(propertiesWithResolvedValueImplemented);\n    forEach.call(declarations, property => {\n      declaration.setProperty(property, getResolvedValue(elt, property));\n    });\n\n    forEach.call(style, property => {\n      declaration.setProperty(property, style.getPropertyValue(property), style.getPropertyPriority(property));\n    });\n\n    return declaration;\n  };\n\n  this.getSelection = function () {\n    return window._document.getSelection();\n  };\n\n  // The captureEvents() and releaseEvents() methods must do nothing\n  this.captureEvents = function () {};\n\n  this.releaseEvents = function () {};\n\n  // ### PUBLIC DATA PROPERTIES (TODO: should be getters)\n\n  function wrapConsoleMethod(method) {\n    return (...args) => {\n      window._virtualConsole.emit(method, ...args);\n    };\n  }\n\n  this.console = {\n    assert: wrapConsoleMethod(\"assert\"),\n    clear: wrapConsoleMethod(\"clear\"),\n    count: wrapConsoleMethod(\"count\"),\n    countReset: wrapConsoleMethod(\"countReset\"),\n    debug: wrapConsoleMethod(\"debug\"),\n    dir: wrapConsoleMethod(\"dir\"),\n    dirxml: wrapConsoleMethod(\"dirxml\"),\n    error: wrapConsoleMethod(\"error\"),\n    group: wrapConsoleMethod(\"group\"),\n    groupCollapsed: wrapConsoleMethod(\"groupCollapsed\"),\n    groupEnd: wrapConsoleMethod(\"groupEnd\"),\n    info: wrapConsoleMethod(\"info\"),\n    log: wrapConsoleMethod(\"log\"),\n    table: wrapConsoleMethod(\"table\"),\n    time: wrapConsoleMethod(\"time\"),\n    timeLog: wrapConsoleMethod(\"timeLog\"),\n    timeEnd: wrapConsoleMethod(\"timeEnd\"),\n    trace: wrapConsoleMethod(\"trace\"),\n    warn: wrapConsoleMethod(\"warn\")\n  };\n\n  function notImplementedMethod(name) {\n    return function () {\n      notImplemented(name, window);\n    };\n  }\n\n  define(this, {\n    name: \"\",\n    status: \"\",\n    devicePixelRatio: 1,\n    innerWidth: 1024,\n    innerHeight: 768,\n    outerWidth: 1024,\n    outerHeight: 768,\n    pageXOffset: 0,\n    pageYOffset: 0,\n    screenX: 0,\n    screenLeft: 0,\n    screenY: 0,\n    screenTop: 0,\n    scrollX: 0,\n    scrollY: 0,\n\n    alert: notImplementedMethod(\"window.alert\"),\n    blur: notImplementedMethod(\"window.blur\"),\n    confirm: notImplementedMethod(\"window.confirm\"),\n    focus: notImplementedMethod(\"window.focus\"),\n    moveBy: notImplementedMethod(\"window.moveBy\"),\n    moveTo: notImplementedMethod(\"window.moveTo\"),\n    open: notImplementedMethod(\"window.open\"),\n    print: notImplementedMethod(\"window.print\"),\n    prompt: notImplementedMethod(\"window.prompt\"),\n    resizeBy: notImplementedMethod(\"window.resizeBy\"),\n    resizeTo: notImplementedMethod(\"window.resizeTo\"),\n    scroll: notImplementedMethod(\"window.scroll\"),\n    scrollBy: notImplementedMethod(\"window.scrollBy\"),\n    scrollTo: notImplementedMethod(\"window.scrollTo\")\n  });\n\n  // ### INITIALIZATION\n\n  process.nextTick(() => {\n    if (!window.document) {\n      return; // window might've been closed already\n    }\n\n    const documentImpl = idlUtils.implForWrapper(window._document);\n\n    if (window.document.readyState === \"complete\") {\n      fireAnEvent(\"load\", window, undefined, {}, documentImpl);\n    } else {\n      window.document.addEventListener(\"load\", () => {\n        fireAnEvent(\"load\", window, undefined, {}, documentImpl);\n\n        if (!documentImpl._pageShowingFlag) {\n          documentImpl._pageShowingFlag = true;\n          fireAnEvent(\"pageshow\", window, PageTransitionEvent, { persisted: false }, documentImpl);\n        }\n      });\n    }\n  });\n}\n\nfunction contextifyWindow(window) {\n  if (vm.isContext(window)) {\n    return;\n  }\n\n  vm.createContext(window);\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}